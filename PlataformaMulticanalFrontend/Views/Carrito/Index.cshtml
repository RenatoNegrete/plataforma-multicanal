@{
    ViewData["Title"] = "Mi Carrito de Compras";
}

@section Styles {
    <link rel="stylesheet" href="~/css/carrito.css" asp-append-version="true" />
}

<!-- Breadcrumb -->
<div class="breadcrumb-section">
    <div class="container-fluid px-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Inicio</a></li>
                <li class="breadcrumb-item active">Mi Carrito</li>
            </ol>
        </nav>
    </div>
</div>

<!-- Cart Section -->
<section class="cart-section">
    <div class="container-fluid px-4">
        <div class="row">
            <!-- Cart Items -->
            <div class="col-lg-8 mb-4">
                <div class="cart-header">
                    <h2><i class="fas fa-shopping-cart me-3"></i>Mi Carrito de Compras</h2>
                    <span class="items-count">1 producto</span>
                </div>

                <!-- Cart Items List -->
                <div class="cart-items-wrapper">
                    <!-- Cart Item 1 -->
                    <div class="cart-item">
                        <div class="item-image">
                            <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="1">
                                <img src="https://nattia.com/wp-content/uploads/2022/01/configuracion-software.png" alt="Laptop Gaming Pro">
                            </a>
                        </div>
                        
                        <div class="item-details">
                            <h5 class="item-title">
                                <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="1">
                                    Instalación de Software
                                </a>
                            </h5>
                            <!-- Cart Items List 
                            <div class="item-attributes">
                                <span class="attribute"><i class="fas fa-palette me-1"></i>Color: Negro</span>
                                <span class="attribute"><i class="fas fa-memory me-1"></i>RAM: 16GB</span>
                                <span class="attribute"><i class="fas fa-hdd me-1"></i>Almacenamiento: 512GB SSD</span>
                            </div>-->
                            <div class="item-stock">
                                <i class="fas fa-check-circle text-success me-1"></i>
                                <span>En stock</span>
                            </div>
                        </div>
                        <div class="item-quantity">
                            <label>Cantidad:</label>
                            <div class="quantity-controls">
                                <button class="btn-quantity" onclick="updateQuantity(this, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="1" min="1" max="10" readonly>
                                <button class="btn-quantity" onclick="updateQuantity(this, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="item-price">
                            <div class="price-old">$75</div>
                            <div class="price-current">$75</div>
                            <div class="price-total">Total: $75</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action btn-favorite" title="Agregar a favoritos">
                                <i class="far fa-heart"></i>
                            </button>
                            <button class="btn-action btn-remove" title="Eliminar" onclick="removeItem(this)">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Cart Item 2 
                    <div class="cart-item">
                        <div class="item-image">
                            <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="2">
                                <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=200&h=200&fit=crop" alt="Auriculares Bluetooth">
                            </a>
                        </div>
                        <div class="item-details">
                            <h5 class="item-title">
                                <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="2">
                                    Auriculares Bluetooth Premium
                                </a>
                            </h5>
                            <div class="item-attributes">
                                <span class="attribute"><i class="fas fa-palette me-1"></i>Color: Negro Mate</span>
                                <span class="attribute"><i class="fas fa-headphones me-1"></i>Cancelación de ruido activa</span>
                            </div>
                            <div class="item-stock">
                                <i class="fas fa-check-circle text-success me-1"></i>
                                <span>En stock</span>
                            </div>
                        </div>
                        <div class="item-quantity">
                            <label>Cantidad:</label>
                            <div class="quantity-controls">
                                <button class="btn-quantity" onclick="updateQuantity(this, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="2" min="1" max="10" readonly>
                                <button class="btn-quantity" onclick="updateQuantity(this, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="item-price">
                            <div class="price-old">$120</div>
                            <div class="price-current">$89</div>
                            <div class="price-total">Total: $178</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action btn-favorite" title="Agregar a favoritos">
                                <i class="far fa-heart"></i>
                            </button>
                            <button class="btn-action btn-remove" title="Eliminar" onclick="removeItem(this)">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                    -->

                    <!-- Cart Item 3 
                    <div class="cart-item">
                        <div class="item-image">
                            <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="3">
                                <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=200&h=200&fit=crop" alt="Smartwatch">
                            </a>
                        </div>
                        <div class="item-details">
                            <h5 class="item-title">
                                <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="3">
                                    Smartwatch Pro Serie 6
                                </a>
                            </h5>
                            <div class="item-attributes">
                                <span class="attribute"><i class="fas fa-palette me-1"></i>Color: Plata</span>
                                <span class="attribute"><i class="fas fa-ruler me-1"></i>Tamaño: 44mm</span>
                            </div>
                            <div class="item-stock">
                                <i class="fas fa-check-circle text-success me-1"></i>
                                <span>En stock</span>
                            </div>
                        </div>
                        <div class="item-quantity">
                            <label>Cantidad:</label>
                            <div class="quantity-controls">
                                <button class="btn-quantity" onclick="updateQuantity(this, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="1" min="1" max="10" readonly>
                                <button class="btn-quantity" onclick="updateQuantity(this, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="item-price">
                            <div class="price-current">$299</div>
                            <div class="price-total">Total: $299</div>
                        </div>
                        <div class="item-actions">
                            <button class="btn-action btn-favorite" title="Agregar a favoritos">
                                <i class="far fa-heart"></i>
                            </button>
                            <button class="btn-action btn-remove" title="Eliminar" onclick="removeItem(this)">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                    -->
                </div>

                <!-- Continue Shopping -->
                <div class="continue-shopping">
                    <a asp-controller="Catalogo" asp-action="Index" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-2"></i>Continuar Comprando
                    </a>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
                <div class="order-summary-sticky">
                    <!-- Discount Coupon -->
                    <div class="coupon-section">
                        <h5><i class="fas fa-ticket-alt me-2"></i>¿Tienes un cupón?</h5>
                        <div class="coupon-input-group">
                            <input type="text" class="form-control" placeholder="Ingresa tu código" id="couponCode">
                            <button class="btn btn-primary" onclick="applyCoupon()">Aplicar</button>
                        </div>
                        <div class="coupon-message" id="couponMessage" style="display: none;"></div>
                    </div>

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h5><i class="fas fa-receipt me-2"></i>Resumen de Compra</h5>
                        
                        <div class="summary-row">
                            <span>Subtotal (1 producto)</span>
                            <span class="amount" id="subtotal">$75</span>
                        </div>

                        <div class="summary-row">
                            <span>Envío</span>
                            <span class="amount text-success" id="shipping">$3</span>
                        </div>

                        <div class="summary-row">
                            <span>Descuento</span>
                            <span class="amount text-danger" id="discount">-$0</span>
                        </div>

                        <div class="summary-row">
                            <span>IVA (19%)</span>
                            <span class="amount" id="tax">$14.25</span>
                        </div>

                        <div class="summary-divider"></div>

                        <div class="summary-row summary-total">
                            <span>Total a Pagar</span>
                            <span class="amount-total" id="total">$92.25</span>
                        </div>

                        <div class="summary-savings">
                            <i class="fas fa-piggy-bank me-2"></i>
                            Ahorras $10 en esta compra
                        </div>

                        <button class="btn btn-success btn-checkout" onclick="goToCheckout()">
                            <i class="fas fa-lock me-2"></i>Proceder al Pago
                        </button>

                        <div class="payment-methods">
                            <small>Aceptamos:</small>
                            <div class="payment-icons">
                                <img src="https://img.shields.io/badge/Visa-1A1F71?style=flat&logo=visa&logoColor=white" alt="Visa">
                                <img src="https://img.shields.io/badge/Mastercard-EB001B?style=flat&logo=mastercard&logoColor=white" alt="Mastercard">
                                <img src="https://img.shields.io/badge/PayPal-00457C?style=flat&logo=paypal&logoColor=white" alt="PayPal">
                            </div>
                        </div>

                        <div class="security-badges">
                            <div class="badge-item">
                                <i class="fas fa-shield-alt text-success"></i>
                                <span>Compra 100% Segura</span>
                            </div>
                            <div class="badge-item">
                                <i class="fas fa-undo text-primary"></i>
                                <span>Devolución en 30 días</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommended Products -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="section-header">
                    <h3 class="section-title">También te puede interesar</h3>
                    <p class="section-subtitle">Productos relacionados con tu carrito</p>
                </div>

                <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-3">
                    @for (int i = 1; i <= 6; i++)
                    {
                        <div class="col">
                            <div class="product-card">
                                <div class="product-image-wrapper">
                                    <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="@i">
                                        <img src="https://images.unsplash.com/photo-1546868871-7041f2a55e12?w=400&h=300&fit=crop" alt="Producto @i">
                                    </a>
                                </div>
                                <div class="product-card-body">
                                    <div class="product-category">TECNOLOGÍA</div>
                                    <h5 class="product-title">
                                        <a asp-controller="Catalogo" asp-action="Detalle" asp-route-id="@i">
                                            Producto Recomendado @i
                                        </a>
                                    </h5>
                                    <div class="product-rating">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <span>(4.0)</span>
                                    </div>
                                    <div class="product-price-section">
                                        <div>
                                            <div class="product-price">$@((i * 50) + 99)</div>
                                        </div>
                                        <button class="btn-add-cart">
                                            <i class="fas fa-cart-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        // Update quantity
        function updateQuantity(button, change) {
            const input = button.parentElement.querySelector('.quantity-input');
            let value = parseInt(input.value) + change;
            const min = parseInt(input.getAttribute('min'));
            const max = parseInt(input.getAttribute('max'));
            
            if (value >= min && value <= max) {
                input.value = value;
                updateCartTotals();
            }
        }

        // Remove item
        function removeItem(button) {
            if (confirm('¿Estás seguro de que deseas eliminar este producto?')) {
                const cartItem = button.closest('.cart-item');
                cartItem.style.opacity = '0';
                cartItem.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    cartItem.remove();
                    updateCartTotals();
                    updateItemsCount();
                }, 300);
            }
        }

        // Apply coupon
        function applyCoupon() {
            const code = document.getElementById('couponCode').value.trim().toUpperCase();
            const messageDiv = document.getElementById('couponMessage');
            
            if (!code) {
                showCouponMessage('Por favor ingresa un código de cupón', 'error');
                return;
            }

            // Simular validación de cupón
            if (code === 'DESCUENTO10') {
                showCouponMessage('¡Cupón aplicado! Descuento de $200', 'success');
                document.getElementById('discount').textContent = '-$200';
                updateCartTotals();
            } else {
                showCouponMessage('Cupón inválido o expirado', 'error');
            }
        }

        function showCouponMessage(message, type) {
            const messageDiv = document.getElementById('couponMessage');
            messageDiv.textContent = message;
            messageDiv.className = coupon-message ${type};
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // Update cart totals
        function updateCartTotals() {
            let subtotal = 0;
            
            document.querySelectorAll('.cart-item').forEach(item => {
                const price = parseFloat(item.querySelector('.price-current').textContent.replace('$', '').replace(',', ''));
                const quantity = parseInt(item.querySelector('.quantity-input').value);
                const itemTotal = price * quantity;
                
                item.querySelector('.price-total').textContent = Total: $${itemTotal.toLocaleString()};
                subtotal += itemTotal;
            });

            const discountText = document.getElementById('discount').textContent;
            const discount = parseFloat(discountText.replace('-$', '').replace(',', '')) || 0;
            const tax = Math.round(subtotal * 0.19);
            const total = subtotal - discount + tax;

            document.getElementById('subtotal').textContent = $${subtotal.toLocaleString()};
            document.getElementById('tax').textContent = $${tax.toLocaleString()};
            document.getElementById('total').textContent = $${total.toLocaleString()};
        }

        // Update items count
        function updateItemsCount() {
            const count = document.querySelectorAll('.cart-item').length;
            document.querySelector('.items-count').textContent = ${count} producto${count !== 1 ? 's' : ''};
        }

        // Go to checkout
        function goToCheckout() {
            window.location.href = '/Checkout';
        }

        // Favorite toggle
        document.querySelectorAll('.btn-favorite').forEach(btn => {
            btn.addEventListener('click', function() {
                const icon = this.querySelector('i');
                icon.classList.toggle('far');
                icon.classList.toggle('fas');
                
                if (icon.classList.contains('fas')) {
                    this.classList.add('active');
                } else {
                    this.classList.remove('active');
                }
            });
        });
    </script>
}